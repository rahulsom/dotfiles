# Top level commands
dcleanup(){
	docker rm -v $(docker ps --filter status=exited -q 2>/dev/null) 2>/dev/null
	docker rmi $(docker images --filter dangling=true -q 2>/dev/null) 2>/dev/null
}

del_stopped(){
	local name=$1
    if [ "$name" = "" ]; then
        docker ps -a | grep Exited | cut -f1 -d " " | xargs docker rm
    else
    	local state=$(docker inspect --format "{{.State.Running}}" $name 2>/dev/null)
    	if [[ "$state" == "false" ]]; then
    		docker rm $name
    	fi
    fi
}

# Useful containers
cadvisor(){
	docker run -d \
		--restart always \
		-v /:/rootfs:ro \
		-v /var/run:/var/run:rw \
		-v /sys:/sys:ro  \
		-v /var/lib/docker/:/var/lib/docker:ro \
		-p 1234:8080 \
		--name cadvisor \
		google/cadvisor

	open http://localhost:1234/
}
alias watchtower='docker run -d --name watchtower -v /var/run/docker.sock:/var/run/docker.sock centurylink/watchtower'

# Machine Learning
alias parsey='docker run --rm -i brianlow/syntaxnet 2>/dev/null'
alias tflow='docker run --rm -v $(pwd):/local -it gcr.io/tensorflow/tensorflow:latest-devel'

# Parsing documents
alias tika='docker run --rm -v $(pwd):/local -it rahulsom/tika'

# Eclipse Che
alias che='docker run --rm -t -v /var/run/docker.sock:/var/run/docker.sock eclipse/che start'

## Databases
alias postgres='docker run --name postgres -e POSTGRES_PASSWORD=mysecretpassword -d -p 5432:5432 postgres'
alias pgsql='docker run --rm -it -e PGPASSWORD=mysecretpassword --link postgres:postgres postgres psql -h postgres -U postgres'

alias mysqld='docker run --name mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql'
function mysql() {
    docker run --rm -it --link mysql:mysql mysql sh -c 'exec mysql -h"$MYSQL_PORT_3306_TCP_ADDR" -P"$MYSQL_PORT_3306_TCP_PORT" -uroot -p"$MYSQL_ENV_MYSQL_ROOT_PASSWORD"'
}

alias redis='docker run --name redis -d -p 6379:6379 redis'
alias redis-cli='docker run -it --link redis:redis --rm redis redis-cli -h redis -p 6379'

alias cassandra='docker run --name cassandra -d -p 9042:9042 cassandra'
function cqlsh() {
    docker run -it --link cassandra:cassandra --rm cassandra sh -c 'exec cqlsh "$CASSANDRA_PORT_9042_TCP_ADDR"'
}

alias mongod='docker run --name mongo -d mongo'
function mongo() {
    docker run -it --link mongo:mongo --rm mongo sh -c 'exec mongo "$MONGO_PORT_27017_TCP_ADDR:$MONGO_PORT_27017_TCP_PORT/test"'
}

## Other Utils
# xq launches xquartz in a way you can tunnel docker applications into it for X11 usage
alias xq='socat TCP-LISTEN:6000,reuseaddr,fork UNIX-CLIENT:\"$DISPLAY\"'

## Text tools
alias pcat='docker run --rm -v $(pwd):/local rahulsom/pcat'
alias irssi='docker run -it --rm -e TERM -u $(id -u):$(id -g) --log-driver=none -v $HOME/.irssi:/home/user/.irssi:ro irssi:alpine'
alias careercup='docker run --rm -v $(pwd):/local rahulsom/careercup'
hostess() { docker run -it --rm -v /etc/hosts:/etc/hosts ondrejmo/hostess "$@" }
how2() { docker run -it --rm ondrejmo/how2 "$@" }
udict() { docker run -it --rm ondrejmo/udict "$@" }

## Browsers
alias dfirefox='docker run --rm -e DISPLAY=${IP}:0 jess/firefox'
alias torbrowser='docker run --rm -e DISPLAY=${IP}:0 paulczar/torbrowser'
alias dchrome='docker run --rm -it -e DISPLAY=${IP}:0 jess/chrome --user-data-dir=/data --no-sandbox'
alias lynx='docker run --rm -it jess/lynx'

## Other apps
alias jenkins='docker run --rm -p 8080:8080 -p 50000:50000 -v $(pwd):/var/jenkins_home jenkins'
alias nexus='docker run --rm -p 8081:8081 -v $(pwd):/nexus-data sonatype/docker-nexus3'
alias artifactoryoss='docker run --rm -v $(pwd)/data:/var/opt/jfrog/artifactory/data -v $(pwd)/logs:/var/opt/jfrog/artifactory/logs -v $(pwd)/etc:/var/opt/jfrog/artifactory/etc -p 8081:8081 docker.bintray.io/jfrog/artifactory-oss:latest'
alias artifactoryregistry='docker run --rm -v $(pwd)/data:/var/opt/jfrog/artifactory/data -v $(pwd)/logs:/var/opt/jfrog/artifactory/logs -v $(pwd)/etc:/var/opt/jfrog/artifactory/etc -p 80:80 -p 8081:8081 docker.bintray.io/jfrog/artifactory-registry:latest'
alias elasticsearch='docker run --rm --name elasticsearch -p 9200:9200 -p 9300:9300 elasticsearch'

## Compilers
alias elm='docker run -it --rm -v "$(pwd):/code" -w "/code" -e "HOME=/tmp" -u $UID:$GID -p 8000:8000 codesimple/elm:0.17'
